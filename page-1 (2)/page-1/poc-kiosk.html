<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1080, initial-scale=1.0">
    <title>Timezone Kiosk - Unified Shell POC</title>
    <link rel="stylesheet" href="style.css">

    <!-- Global Styles for Views -->
    <style>
        /* Hide all views by default */
        .view-section {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 1080px;
            height: 1920px;
            z-index: 10;
            background: transparent !important;
        }

        .view-section.active {
            display: block;
        }

        /* Video Backgrounds - All loaded once, hidden by default */
        .global-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 1080px;
            height: 1920px;
            object-fit: cover;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .global-video.active {
            opacity: 1;
        }

        /* Content layer above videos */
        #views-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 1080px;
            height: 1920px;
            z-index: 10;
            background: transparent;
        }

        /* Loading Overlay */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        #loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #loading img {
            width: 300px;
            margin-bottom: 40px;
        }

        #loading-text {
            font-family: 'Nulshock', Arial, sans-serif;
            color: #33fff9;
            font-size: 24px;
            letter-spacing: 3px;
        }

        /* ===== SCREENSAVER SPECIFIC STYLES ===== */
        @font-face {
            font-family: 'Nulshock';
            src: url('nulshock/nulshock-heavy.otf') format('opentype');
            font-weight: bold;
            font-style: normal;
        }

        #view-screensaver .screensaver-container {
            width: 1080px;
            height: 1920px;
            position: relative;
            overflow: hidden;
            background: transparent !important;
        }

        #view-screensaver .offer-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 60px;
        }

        #view-screensaver .offer-slide.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #view-screensaver .logo-section {
            margin-bottom: 20px;
            transform: translate(-2.66666px, -10.6668px) scale(1) !important;
        }

        #view-screensaver .logo-img {
            width: 450px;
            height: auto;
            margin-top: 100px;
        }

        #view-screensaver .offer-title {
            font-family: 'Nulshock', sans-serif;
            font-size: 60px;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3), 0 4px 8px rgba(0, 0, 0, 0.5);
            letter-spacing: 5px;
            margin-bottom: 40px;
            max-width: 1000px;
            text-align: center;
            position: absolute;
            top: 350px;
        }

        #view-screensaver .card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin-top: 20px;
        }

        #view-screensaver .cat-animation {
            position: absolute;
            top: -150px;
            left: 50%;
            width: 450px;
            height: auto;
            z-index: 5;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.4));
            transform: translate(-314.667px, 288px) scale(1) !important;
        }

        #view-screensaver .offer-card-wrapper {
            position: relative;
            z-index: 10;
        }

        #view-screensaver .offer-card-bg {
            width: 1080px;
            height: auto;
            filter: drop-shadow(0 10px 40px rgba(255, 100, 150, 0.4));
            transform: translate(-21.3333px, 365.333px) scale(1) !important;
        }

        #view-screensaver .card-text-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        #view-screensaver .rb-amount {
            font-family: 'Nulshock', sans-serif;
            font-size: 72px;
            color: #182c4f;
            margin-bottom: 10px;
        }

        #view-screensaver .rb-unit {
            font-size: 36px;
            color: #182c4f;
        }

        #view-screensaver .dapat-section {
            text-align: center;
        }

        #view-screensaver .dapat-label {
            font-family: 'Nulshock', sans-serif;
            font-size: 24px;
            color: #ffffff;
            letter-spacing: 2px;
        }

        #view-screensaver .tizo-amount {
            font-family: 'Nulshock', sans-serif;
            font-size: 96px;
            color: #acfcff;
            text-shadow: 0 0 20px rgba(51, 255, 249, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        #view-screensaver .tizo-unit {
            font-family: 'Nulshock', sans-serif;
            font-size: 36px;
            color: #acfcff;
            letter-spacing: 10px;
            margin-top: 10px;
        }

        #view-screensaver .tap-hint {
            position: absolute;
            bottom: 100px;
            width: 100%;
            text-align: center;
            left: 0;
            font-family: 'Nulshock', sans-serif;
            font-size: 32px;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: 3px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <!-- ===== GLOBAL VIDEO BACKGROUNDS (Loaded ONCE, Never Reload) ===== -->
    <video id="bg-main" class="global-video active" autoplay loop muted playsinline>
        <source src="other-bg.mp4" type="video/mp4">
    </video>
    <video id="bg-ood" class="global-video" autoplay loop muted playsinline>
        <source src="OOD-BACKGROUND.mp4" type="video/mp4">
    </video>
    <video id="bg-ooh" class="global-video" autoplay loop muted playsinline>
        <source src="OOH-BACKGROUND.mp4" type="video/mp4">
    </video>
    <video id="bg-snacks" class="global-video" autoplay loop muted playsinline>
        <source src="free-snacks-bg.mp4" type="video/mp4">
    </video>

    <!-- ===== VIEWS CONTAINER ===== -->
    <div id="views-container">

        <!-- ===== VIEW: WELCOME ===== -->
        <div id="view-welcome" class="view-section active">
            <div class="container" style="background: transparent !important;">
                <div class="language-selector">
                    <button id="lang-btn-welcome">
                        <span id="current-lang-welcome">Bahasa</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div id="lang-dropdown-welcome" class="dropdown-content hidden">
                        <div onclick="WelcomeView.setLanguage('en')">English</div>
                        <div onclick="WelcomeView.setLanguage('id')">Bahasa</div>
                    </div>
                </div>

                <div class="content">
                    <img src="timezone-branding.png" alt="Timezone Logo" class="logo timezone-branding"
                        style="z-index: -1; position: relative;">

                    <h1 id="main-text-welcome" class="glow-text"
                        style="z-index: 9; position: relative; transform: translate(0px, -25.2px) scale(1.6); font-weight: bold;">
                        ISI SALDOMU<br>DI SINI!
                    </h1>

                    <div class="character-wrapper" style="transform: translate(0px, -40px) scale(2.5);">
                        <img src="cat-character.gif" alt="Character" class="character">
                    </div>

                    <div class="button-wrapper" onclick="WelcomeView.handleStart()"
                        style="transform: translate(6px, 21px) scale(1.7) !important;">
                        <img src="button.png" alt="Start Button" class="button-bg">
                        <span id="button-text-welcome" class="button-text">MULAI</span>
                    </div>

                    <img src="timezone-branding.png" alt="Added Image" class="timezone-branding"
                        style="position: absolute; top: 50%; left: 49%; z-index: 50; 
                                transform: translate(calc(-50% + 5.33337px), calc(-50% - 634.667px)) scale(1.5); width: 300px;">
                </div>
            </div>
        </div>

        <!-- ===== VIEW: SCREENSAVER ===== -->
        <div id="view-screensaver" class="view-section">
            <div class="screensaver-container">
                <!-- OOD Slide -->
                <div class="offer-slide" id="slide-ood">
                    <div class="logo-section">
                        <img src="timezone-branding.png" alt="Timezone" class="logo-img">
                    </div>
                    <h1 class="offer-title">OFFER OF THE DAY</h1>
                    <div class="card-container">
                        <img src="cat-screensaver.gif" alt="Cat" class="cat-animation">
                        <div class="offer-card-wrapper">
                            <img src="ooh-card.png" alt="Offer Card" class="offer-card-bg">
                            <div class="card-text-overlay"
                                style="transform: translate(-53.3333px, 338.667px) scale(1);">
                                <div class="rb-amount">
                                    <span id="rb-value-ood">120</span><span class="rb-unit">RB</span>
                                </div>
                                <div class="dapat-section">
                                    <div class="dapat-label">DAPAT</div>
                                    <div>
                                        <span class="tizo-amount" id="tizo-value-ood">140</span>
                                        <span class="tizo-unit">TIZO</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tap-hint">TAP TO CONTINUE</div>
                </div>
            </div>
        </div>

    </div><!-- End views-container -->

    <!-- ===== LOADING SCREEN ===== -->
    <div id="loading">
        <img src="timezone-branding.png" alt="Loading">
        <div id="loading-text">LOADING...</div>
    </div>

    <!-- ===== GLOBAL SCRIPTS (Loaded ONCE) ===== -->

    <script src="shell-connector.js"></script>
    <script src="api-config.js"></script>
    <script src="language.js"></script>
    <script src="session-manager.js"></script>

    <!-- ===== VIEW MANAGER ===== -->
    <script>
        /**
         * UNIFIED KIOSK VIEW MANAGER
         * 
         * This demonstrates the "Single File Shell" architecture:
         * 1. ALL videos are loaded once and NEVER reload
         * 2. Views are show/hide (not fetch/inject)
         * 3. Scripts are scoped to avoid global conflicts
         * 4. Navigation is instant (DOM display toggle)
         */
        const KioskApp = {
            currentView: null,
            views: {},

            // Initialize the app
            init: function () {
                console.log('KioskApp initializing...');

                // Wait for main video to be ready
                const mainVideo = document.getElementById('bg-main');
                const loading = document.getElementById('loading');

                const startApp = () => {
                    // Navigate to initial view
                    KioskApp.navigate('welcome');

                    // Hide loading screen
                    setTimeout(() => {
                        loading.classList.add('hidden');
                    }, 500);
                };

                if (mainVideo.readyState >= 3) {
                    startApp();
                } else {
                    mainVideo.addEventListener('canplay', startApp, { once: true });
                    mainVideo.addEventListener('error', startApp, { once: true });
                    setTimeout(startApp, 2000); // Fallback
                }
            },

            // Navigate to a view
            navigate: function (viewId) {
                console.log('Navigating to:', viewId);

                // Hide all views
                document.querySelectorAll('.view-section').forEach(el => {
                    el.classList.remove('active');
                });

                // Show target view
                const targetView = document.getElementById('view-' + viewId);
                if (targetView) {
                    targetView.classList.add('active');
                    this.currentView = viewId;

                    // Switch background video
                    this.switchBackground(viewId);

                    // Call view's init function if exists
                    if (this.views[viewId] && this.views[viewId].init) {
                        this.views[viewId].init();
                    }
                }
            },

            // Switch background video (instant, no reload)
            switchBackground: function (viewId) {
                const bgMap = {
                    'welcome': 'bg-main',
                    'screensaver': 'bg-ood'
                };

                const targetBg = bgMap[viewId] || 'bg-main';

                // Hide all backgrounds
                document.querySelectorAll('.global-video').forEach(v => {
                    v.classList.remove('active');
                });

                // Show target background
                const bg = document.getElementById(targetBg);
                if (bg) {
                    bg.classList.add('active');
                }
            }
        };

        // Map PageTransition for backward compatibility
        window.PageTransition = {
            navigateTo: function (url) {
                // Extract view name from URL
                const viewName = url.replace('.html', '').replace('welcome2', 'screensaver');
                KioskApp.navigate(viewName);
            }
        };
    </script>

    <!-- ===== WELCOME VIEW LOGIC (Scoped) ===== -->
    <script>
        /**
         * WELCOME VIEW
         * All variables and functions are scoped inside WelcomeView object
         * This prevents global conflicts with other views
         */
        const WelcomeView = (function () {
            // Private variables (scoped, no conflict)
            let currentLang = getCurrentLanguage();
            let idleTimeout;
            const IDLE_TIME = 10000;

            const translations = {
                en: {
                    main: "TOP-UP<br>HERE!",
                    button: "START",
                    langLabel: "English"
                },
                id: {
                    main: "ISI SALDOMU<br>DI SINI!",
                    button: "MULAI",
                    langLabel: "Bahasa"
                }
            };

            function applyLanguage(lang) {
                currentLang = lang;
                const data = translations[lang];
                document.getElementById('main-text-welcome').innerHTML = data.main;
                document.getElementById('button-text-welcome').textContent = data.button;
                document.getElementById('current-lang-welcome').textContent = data.langLabel;
            }

            function toggleLanguage() {
                const dropdown = document.getElementById('lang-dropdown-welcome');
                dropdown.classList.toggle('hidden');
            }

            function setLanguage(lang) {
                saveLanguage(lang);
                applyLanguage(lang);
                document.getElementById('lang-dropdown-welcome').classList.add('hidden');
            }

            function handleStart() {
                // Navigate to screensaver (or next page)
                KioskApp.navigate('screensaver');
            }

            function resetIdleTimer() {
                clearTimeout(idleTimeout);
                idleTimeout = setTimeout(() => {
                    if (KioskApp.currentView === 'welcome') {
                        KioskApp.navigate('screensaver');
                    }
                }, IDLE_TIME);
            }

            function init() {
                console.log('WelcomeView init');
                applyLanguage(currentLang);

                // Start idle timer
                ['mousemove', 'mousedown', 'keypress', 'touchstart', 'click'].forEach(event => {
                    document.addEventListener(event, resetIdleTimer, true);
                });
                resetIdleTimer();

                // Start fresh session
                startNewSession(true);
            }

            function destroy() {
                clearTimeout(idleTimeout);
            }

            // Public API
            return {
                init: init,
                destroy: destroy,
                handleStart: handleStart,
                toggleLanguage: toggleLanguage,
                setLanguage: setLanguage
            };
        })();

        // Register with KioskApp
        KioskApp.views['welcome'] = WelcomeView;
    </script>

    <!-- ===== SCREENSAVER VIEW LOGIC (Scoped) ===== -->
    <script>
        /**
         * SCREENSAVER VIEW
         * Completely isolated from WelcomeView
         */
        const ScreensaverView = (function () {
            // Private variables (scoped, no conflict with WelcomeView)
            let currentLang = getCurrentLanguage();

            function init() {
                console.log('ScreensaverView init');

                // Update tap hint based on language
                const tapHintText = currentLang === 'id' ? 'TEKAN UNTUK MELANJUTKAN' : 'TAP TO CONTINUE';
                document.querySelectorAll('#view-screensaver .tap-hint').forEach(el => {
                    el.textContent = tapHintText;
                });

                // Add tap handler
                document.getElementById('view-screensaver').onclick = handleTap;
            }

            function handleTap() {
                KioskApp.navigate('welcome');
            }

            function destroy() {
                document.getElementById('view-screensaver').onclick = null;
            }

            return {
                init: init,
                destroy: destroy
            };
        })();

        // Register with KioskApp
        KioskApp.views['screensaver'] = ScreensaverView;
    </script>

    <!-- ===== START THE APP ===== -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            KioskApp.init();
        });
    </script>

</body>

</html>