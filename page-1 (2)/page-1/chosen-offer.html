<!DOCTYPE html>
<html lang="en">

<head> </head>

<body>
  <plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>
  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style><plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>
  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style><plasmo-csui></plasmo-csui>
  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style><plasmo-csui></plasmo-csui>

  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <plasmo-csui></plasmo-csui>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1080, initial-scale=1.0" />
  <title>Timezone - Great Choice</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Fixed for 1080x1920 resolution */
    html,
    body {
      overflow: hidden;
    }

    .container {
      width: 1080px;
      height: 1920px;
      overflow: hidden;
    }

    .content {
      padding: 60px 50px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
    }

    /* Back Button */

    /* Selected Offer Card */
    .selected-offer-section {
      margin-top: 10px;
      margin-bottom: 20px;
      margin-left: -10px;
      display: flex;
      justify-content: center;
    }

    .selected-offer-card {
      position: relative;
      width: 380px;
      border-radius: 25px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
    }

    /* Animated Gif position */
    .badge-icon.badge-top-left {
      width: 100px;
      position: absolute;
      z-index: 1000;
      left: 0;
      top: 0;
    }

    .badge-icon.badge-top-right {
      width: 100px;
      position: absolute;
      z-index: 1000;
      right: 0;
      top: 0;
    }

    .badge-icon.badge-bottom-left {
      width: 100px;
      position: absolute;
      z-index: 1000;
      left: 0;
      bottom: 0;
    }

    .badge-icon.badge-bottom-right {
      width: 100px;
      position: absolute;
      z-index: 1000;
      right: 0;
      bottom: 0;
    }

    /* End Animated Gif position */

    .selected-offer-card:hover {
      transform: scale(1.03);
    }

    .selected-offer-card img {
      width: 100%;
      height: auto;
      display: block;
    }

    .selected-offer-card .selection-overlay {
      display: none;
    }

    .selected-offer-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 15px;
      pointer-events: none;
    }

    .offer-top {
      text-align: center;
    }

    .offer-rb-value {
      font-family: "Nulshock", sans-serif;
      font-size: 56px;
      color: #1a1a2e;
      font-weight: bold;
    }

    .offer-rb-unit {
      font-family: "Nulshock", sans-serif;
      font-size: 28px;
      color: #1a1a2e;
    }

    .offer-bottom {
      text-align: center;
    }

    .offer-gets {
      font-family: "Nulshock", sans-serif;
      font-size: 20px;
      color: #ffd700;
      letter-spacing: 3px;
      margin-bottom: 5px;
    }

    .offer-tizo-value {
      font-family: "Nulshock", sans-serif;
      font-size: 48px;
      color: #00d4ff;
      font-weight: bold;
    }

    .offer-tizo-unit {
      font-family: "Nulshock", sans-serif;
      font-size: 24px;
      color: #00d4ff;
    }

    /* Great Choice Message */
    .message-section {
      text-align: center;
      margin: 35px 0;
      padding: 0 40px;
    }

    .great-choice {
      font-family: "Nulshock", sans-serif;
      font-size: 48px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 4px;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      margin-bottom: 10px;
    }

    .special-offers-text {
      font-family: "Nulshock", sans-serif;
      font-size: 40px;
      color: #b8f5ff;
      text-transform: uppercase;
      letter-spacing: 2px;
      line-height: 1.4;
      font-weight: bold;
    }

    /* Additional Offers Section */
    .additional-offers {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin: 20px 0;
    }

    .additional-offer-card {
      position: relative;
      width: 420px;
      border-radius: 20px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
    }

    .additional-offer-card:hover {
      transform: scale(1.03);
    }

    /* Selected card uses only the overlay image, no extra borders */
    .selected-offer-card,
    .selected-offer-card.selected,
    .selected-offer-card img,
    .additional-offer-card,
    .additional-offer-card.selected,
    .additional-offer-card img {
      outline: none !important;
      border: none !important;
      box-shadow: none !important;
    }

    .selected-offer-card:focus,
    .selected-offer-card.selected:focus,
    .additional-offer-card:focus,
    .additional-offer-card.selected:focus {
      outline: none !important;
    }

    .selection-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
      display: none !important;
      z-index: 10;
    }

    .additional-offer-card.selected .selection-overlay,
    .selected-offer-card.selected .selection-overlay {
      display: block !important;
    }

    .additional-offer-card img:not(.selection-overlay) {
      width: 100%;
      height: auto;
      display: block;
    }

    .additional-offer-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 15px;
      pointer-events: none;
    }

    .additional-rb {
      font-family: "Nulshock", sans-serif;
      font-size: 60px;
      color: #1a1a2e;
      text-align: center;
      font-weight: bold;
    }

    .additional-rb .unit {
      font-size: 22px;
    }

    .additional-bottom {
      text-align: center;
    }

    .additional-gets {
      font-family: "Nulshock", sans-serif;
      font-size: 20px;
      color: #ffd700;
      letter-spacing: 3px;
    }

    .additional-tizo {
      font-family: "Nulshock", sans-serif;
      font-size: 48px;
      color: #00d4ff;
      font-weight: bold;
    }

    .additional-tizo .unit {
      font-size: 24px;
    }

    /* Next Button */
    .next-button {
      position: relative;
      width: 500px;
      height: 100px;
      cursor: pointer;
      margin: auto auto 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.2s;
    }

    .next-button:hover {
      transform: translateY(-4px);
    }

    .next-button:active {
      transform: scale(0.95);
    }

    .next-button img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .next-button-text {
      position: relative;
      z-index: 1;
      font-family: "Nulshock", sans-serif;
      font-size: 36px;
      color: white;
      letter-spacing: 2px;
      text-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
    }

    /* Base styles for editable elements inside offer cards - ALWAYS applied to prevent layout shift */
    .selected-offer-content .editable,
    .additional-offer-content .editable,
    .offer-top .editable,
    .offer-bottom .editable,
    .additional-rb .editable,
    .additional-bottom .editable,
    .additional-tizo .editable,
    .additional-rb span,
    .additional-tizo span,
    #additional-rb-1,
    #additional-rb-2,
    #additional-tizo-1,
    #additional-tizo-2 {
      display: inline-block;
      position: relative;
    }

    /* Edit Mode Support - ONLY enable pointer events, no layout changes */
    .edit-mode-active .selected-offer-content,
    .edit-mode-active .additional-offer-content,
    .edit-mode-active .offer-top,
    .edit-mode-active .offer-bottom,
    .edit-mode-active .additional-rb,
    .edit-mode-active .additional-bottom,
    .edit-mode-active .additional-tizo {
      pointer-events: auto !important;
    }

    .edit-mode-active .selected-offer-content .editable,
    .edit-mode-active .additional-offer-content .editable,
    .edit-mode-active .offer-top .editable,
    .edit-mode-active .offer-bottom .editable,
    .edit-mode-active .additional-rb .editable,
    .edit-mode-active .additional-bottom .editable,
    .edit-mode-active .additional-tizo .editable,
    .edit-mode-active .additional-rb span,
    .edit-mode-active .additional-tizo span,
    .edit-mode-active #additional-rb-1,
    .edit-mode-active #additional-rb-2,
    .edit-mode-active #additional-tizo-1,
    .edit-mode-active #additional-tizo-2 {
      pointer-events: auto !important;
      cursor: move !important;
    }

    .edit-mode-active .editable:hover {
      outline: 2px dashed rgba(255, 255, 255, 0.5) !important;
    }

    /* In edit mode, selected elements get a subtle white outline (not for card selection) */
    .edit-mode-active .editable.edit-active {
      outline: 2px solid rgba(255, 255, 255, 0.8) !important;
      pointer-events: auto !important;
      cursor: move !important;
    }

    /* Card selection blackout effect - when a card is selected, unselected cards are dimmed */
    .selection-made .selected-offer-card:not(.selected),
    .selection-made .additional-offer-card:not(.selected) {
      filter: brightness(0.4) grayscale(0.5);
      opacity: 1;
      transition: all 0.3s ease;
    }

    .selection-made .selected-offer-card.selected,
    .selection-made .additional-offer-card.selected {
      filter: none;
      opacity: 1;
      transition: all 0.3s ease;
    }

    .selected-offer-card {
      margin-top: 0px;
    }

    /* Old TIZO strikethrough styling */
    .offer-old-tizo {
      font-family: "Nulshock", "Arial Black", sans-serif;
      font-size: 18px;
      font-weight: bold;
      color: rgba(0, 212, 255, 0.4);
      text-decoration: line-through;
      text-decoration-color: #dc2626;
      text-decoration-thickness: 2px;
      margin-bottom: 2px;
      display: flex;
      align-items: baseline;
      justify-content: center;
    }

    .offer-old-tizo-number {
      font-size: inherit;
    }

    .offer-old-tizo-unit {
      font-size: 0.6em;
      margin-left: 2px;
    }

    .additional-old-tizo {
      font-family: "Nulshock", "Arial Black", sans-serif;
      font-size: 18px;
      font-weight: bold;
      color: rgba(0, 212, 255, 0.4);
    }

    .additional-old-tizo .price-text {
      text-decoration: line-through;
      text-decoration-thickness: 2px;
      text-decoration-color: red;
    }

    .additional-old-tizo .unit {
      font-size: 0.6em;
      margin-left: 2px;
      text-decoration: line-through;
      text-decoration-thickness: 2px;
      text-decoration-color: red;
    }

    /* Badge icons for OOD/OOH offers */
    .selected-offer-card,
    .additional-offer-card {
      position: relative;
    }

    .badge-icon {
      position: absolute;
      z-index: 20;
      pointer-events: none;
      /* Constrain icon size regardless of source image size */
      max-width: 80px;
      max-height: 80px;
      width: auto;
      height: auto;
      object-fit: contain;
    }

    .badge-icon.badge-hidden {
      display: none !important;
    }

    /* Globally hide all badge icons as requested */
    .badge-icon {
      display: none !important;
    }

    .badge-top-left {
      top: -15px;
      left: -15px;
    }

    .badge-top-right {
      top: -15px;
      right: -15px;
    }

    .badge-bottom-left {
      bottom: -15px;
      left: -15px;
    }

    .badge-bottom-right {
      bottom: -15px;
      right: -15px;
    }

    /* Slightly smaller badges for additional offer cards (they are already scaled 1.6x) */
    .additional-offer-card .badge-icon {
      max-width: 55px;
      max-height: 55px;
    }

    /* You Chose Text styling */
    .you-chose-text {
      font-family: "Nulshock", sans-serif;
      font-size: 38px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-weight: bold;
      text-align: center;
      margin-top: 170px !important;
      margin-bottom: 50px;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      transition: opacity 0.3s ease;
    }

    /* Pick One Text styling */
    .pick-one-text {
      font-family: "Nulshock", sans-serif;
      font-size: 40px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-weight: bold;
      text-align: center;
      margin-top: 248px;
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 20px rgba(72, 255, 255, 0.6);
      position: relative;
      z-index: 100;
    }
  </style>
  <style type="text/css" id="mytempCss">
    ._8mqQwQ {
      display: none;
    }

    ._1TWLMK.icF5zO {
      opacity: 0.01;
    }
  </style>

  <div class="container" bis_skin_checked="1">
    <!-- Video Background -->
    <video class="video-bg" autoplay="" loop="" muted="" playsinline="">
      <source src="other-bg.mp4" type="video/mp4" />
    </video>
    <!-- Back Button -->
    <img src="back-button.png" alt="Back" class="back-button" onclick="window.history.back()" />

    <!-- Home Button -->
    <img src="home.png" alt="Home" class="editable added-element" data-id="home-button" onclick="goHome()"
      style="max-width: 200px; height: auto; position: absolute; top: 31px; right: 30px; z-index: 50; cursor: pointer" />

    <div class="content" bis_skin_checked="1">
      <!-- You Chose Text -->
      <p class="you-chose-text" id="you-chose-text">INI PILIHAN MU</p>

      <!-- Selected Offer Card -->
      <div class="selected-offer-section" bis_skin_checked="1" style="margin-top: 10px;">
        <div class="selected-offer-card editable" id="selected-offer" data-id="selected-offer"
          onclick="selectOfferCard(this)" style="transform: translate(2.66678px, 18.6666px) scale(1.6)"
          bis_skin_checked="1">
          <img class="selection-overlay" src="SELECTED-small-box.png" alt="Selected" />
          <img id="selected-card-img" src="SMALL-BUTTON-pink.png" alt="Selected Offer" data-no-text-edit="true" />
          <div class="selected-offer-content" bis_skin_checked="1">
            <div class="offer-top" bis_skin_checked="1" style="transform: translate(2px, -7px)"><span
                class="offer-rb-value" id="selected-rb">100</span><span class="offer-rb-unit"
                id="selected-rb-unit">RB</span></div>
            <div class="offer-bottom" bis_skin_checked="1">
              <div class="offer-gets" bis_skin_checked="1" style="transform: translate(0px, 5px)">DAPAT</div>
              <div class="offer-old-tizo" bis_skin_checked="1" style="transform: translate(0, 3px)">
                <span class="offer-old-tizo-number" id="selected-old-tizo">100</span><span
                  class="offer-old-tizo-unit">TIZO</span>
              </div>
              <div style="transform: translate(0px, -5px)"><span class="offer-tizo-value"
                  id="selected-tizo">110</span><span class="offer-tizo-unit">TIZO</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Great Choice Message -->
      <div class="message-section editable" data-id="message-section" style="transform: translate(-5px, 50px) scale(1)"
        bis_skin_checked="1">
        <h1 class="great-choice editable" data-id="great-choice" style="transform: translate(0px, 0px) scale(1)">PILIHAN
          BAGUS!</h1>
        <p class="special-offers-text editable" data-id="special-offers-text"
          style="transform: translate(0px, 0px) scale(1)">
          KAMU PUNYA <span id="offers-count">2</span><br />PENAWARAN SPESIAL<br />LAGI UNTUK KAMU!
        </p>
      </div>

      <!-- Additional Offers -->
      <div class="additional-offers" id="additional-offers" bis_skin_checked="1">
        <!-- Offer 1 -->
        <div class="additional-offer-card editable" id="additional-offer-1" data-id="additional-offer-1"
          onclick="selectAdditionalOffer(this)" data-offer-id="upsell-1" data-cost="120000" data-tizo-credit="140"
          style="transform: translate(29.3331px, 450px) scale(1.6); margin-left: -50px" bis_skin_checked="1">
          <img class="selection-overlay" src="SELECTED-small-box.png" alt="Selected" />
          <img id="additional-img-1" src="SMALL-BUTTON-purple.png" alt="Special Offer" data-no-text-edit="true" />
          <div class="additional-offer-content" bis_skin_checked="1">
            <div class="additional-rb" bis_skin_checked="1" style="transform: translate(0, -12px)"><span
                id="additional-rb-1">120</span><span class="unit" id="additional-rb-1-unit">RB</span></div>
            <div class="additional-bottom" bis_skin_checked="1" style="transform: translate(0, 3px)">
              <div class="additional-gets" bis_skin_checked="1">DAPAT</div>
              <div class="additional-old-tizo" bis_skin_checked="1" style="transform: translate(0, 3px)">
                <span id="additional-old-tizo-1" class="price-text">120</span><span class="unit">TIZO</span>
              </div>
              <div class="additional-tizo" bis_skin_checked="1" style="transform: translate(0, -3px)"><span
                  id="additional-tizo-1">140</span><span class="unit">TIZO</span></div>
            </div>
          </div>
        </div>

        <!-- Offer 2 -->
        <div class="additional-offer-card editable" id="additional-offer-2" data-id="additional-offer-2"
          onclick="selectAdditionalOffer(this)" data-offer-id="upsell-2" data-cost="150000" data-tizo-credit="180"
          style="transform: translate(18.6667px, -230.667px) scale(1.6); margin-left: -40px" bis_skin_checked="1">
          <img class="selection-overlay" src="SELECTED-small-box.png" alt="Selected" />
          <img id="additional-img-2" src="SMALL-BUTTON-ORANGE.png" alt="Special Offer" data-no-text-edit="true" />
          <div class="additional-offer-content" bis_skin_checked="1">
            <div class="additional-rb" bis_skin_checked="1" style="transform: translate(0, -12px)"><span
                id="additional-rb-2">150</span><span class="unit" id="additional-rb-2-unit">RB</span></div>
            <div class="additional-bottom" bis_skin_checked="1" style="transform: translate(0, 3px)">
              <div class="additional-gets" bis_skin_checked="1">DAPAT</div>
              <div class="additional-old-tizo" bis_skin_checked="1" style="transform: translate(0, 3px)">
                <span id="additional-old-tizo-2" class="price-text">150</span><span class="unit">TIZO</span>
              </div>
              <div class="additional-tizo" bis_skin_checked="1" style="transform: translate(0, -3px)"><span
                  id="additional-tizo-2">180</span><span class="unit">TIZO</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pick One Text -->
      <p class="pick-one-text" id="pick-one-text">PILIH SATU</p>

      <!-- Next Button -->
      <div class="next-button editable" data-id="next-button" onclick="handleNext()" style="transform: scale(1)"
        bis_skin_checked="1">
        <img src="button.png" alt="Next Button" />
        <span class="next-button-text editable" data-id="next-button-text">SELANJUTNYA</span>
      </div>
    </div>
  </div>


  <script src="shell-connector.js"></script>
  <script src="api-config.js"></script>
  <script src="session-manager.js"></script>
  <script src="currency-formatter.js"></script>

  <script>
    let selectedOfferData = null;
    let additionalOffers = [];
    let clickAudio = null;

    // Initialize audio when page loads
    function initAudio() {
      try {
        clickAudio = new Audio("./click.mp3");
        clickAudio.preload = "auto";
        clickAudio.volume = 0.8;
      } catch (error) {
        console.warn("Could not load click audio:", error);
      }
    }

    // Play click sound function
    function playClickSound() {
      try {
        if (clickAudio) {
          clickAudio.currentTime = 0;
          clickAudio.play().catch((error) => {
            console.warn("Could not play click sound:", error);
          });
        }
      } catch (error) {
        console.warn("Error playing click sound:", error);
      }
    }

    // Language translations
    const translations = {
      en: {
        youChose: "YOUR CHOSEN OPTION",
        greatChoice: "SPECIAL OFFERS",
        specialOffers: "<span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>FOR YOU</span>",
        pickOne: "PICK ONE",
        notInterested: "SKIPPED BONUS?<br><span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>STILL A GREAT CHOICE</span>",
        smartMove: "SMART MOVE!<br><span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>MORE BONUS FOR YOU</span>",
        topOffer: "AWESOME PICK!<br><span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>MAX BONUS SECURED</span>",
        gets: "GETS",
        nextBtn: "NEXT",
      },
      id: {
        youChose: "INI PILIHANMU",
        greatChoice: "REKOMENDASI SPESIAL",
        specialOffers: "<span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>UNTUK KAMU</span>",
        pickOne: "PILIH SATU",
        notInterested: "LEWATI BONUS?<br><span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>TETAP PILIHAN BAGUS</span>",
        smartMove: "KAMU DAPAT<br><span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>BONUS TAMBAHAN</span>",
        topOffer: "KAMU DAPAT<br><span style='font-size:40px; color:#b8f5ff; display:block; font-weight:bold; margin-top:15px;'>BONUS MAKSIMAL</span>",
        gets: "DAPAT",
        nextBtn: "SELANJUTNYA",
      },
    };

    function getCurrentLanguage() {
      return localStorage.getItem("tizo_language") || "id";
    }

    function updateLanguageDisplay() {
      const lang = getCurrentLanguage();
      const t = translations[lang];

      // Update "you chose" text
      const youChoseEl = document.getElementById("you-chose-text");
      if (youChoseEl) {
        youChoseEl.textContent = t.youChose;
      }

      // Update great choice text (initial state - no selection)
      document.querySelector(".great-choice").innerHTML = t.greatChoice;

      // Update special offers text
      const specialOffersEl = document.querySelector(".special-offers-text");
      if (specialOffersEl) {
        specialOffersEl.style.display = "block"; // Reset to visible on language update/init
        specialOffersEl.innerHTML = t.specialOffers;
      }

      // Update all "GETS" text to "DAPAT"
      document.querySelectorAll(".offer-gets, .additional-gets").forEach((el) => {
        el.textContent = t.gets;
      });

      // Update next button
      document.querySelector(".next-button-text").textContent = t.nextBtn;

      // Update pick one text
      const pickOneEl = document.getElementById("pick-one-text");
      if (pickOneEl) {
        pickOneEl.textContent = t.pickOne;
      }
    }

    function goBack() {
      if (window.isEditModeActive && window.isEditModeActive()) return;
      window.location.href = "offers-selection.html";
    }

    function goHome() {
      if (window.isEditModeActive && window.isEditModeActive()) return;
      window.location.href = "welcome.html";
    }

    async function loadOfferData() {
      // Get selected offer from localStorage
      const storedData = localStorage.getItem("selectedOfferData");
      if (storedData) {
        selectedOfferData = JSON.parse(storedData);
        updateSelectedOfferDisplay();

        // Fetch additional offers
        await fetchAdditionalOffers();

        // Apply language after data is loaded
        updateLanguageDisplay();
      } else {
        console.log("No selected offer found, redirecting...");
        window.location.href = "offers-selection.html";
      }
    }

    function updateSelectedOfferDisplay() {
      if (!selectedOfferData) return;

      const costInRb = Math.round(parseFloat(selectedOfferData.cost) / 1000);
      const tizoCredit = Math.round(parseFloat(selectedOfferData.tizoCredit));

      // Update the main selected offer display
      const rbValueEl = document.getElementById("selected-rb");
      const rbUnitEl = document.getElementById("selected-rb-unit");
      if (typeof formatAndUpdateRbDisplay === 'function') {
        formatAndUpdateRbDisplay(rbValueEl, rbUnitEl, costInRb);
      } else {
        rbValueEl.textContent = costInRb;
      }
      document.getElementById("selected-tizo").textContent = tizoCredit;

      // Update old TIZO strikethrough value (same as RB value - base value before bonus)
      const oldTizoEl = document.getElementById("selected-old-tizo");
      if (oldTizoEl) {
        oldTizoEl.textContent = costInRb;
      }

      // Fetch and update badge icons for OOD/OOH offers from API
      fetchOfferIcons(selectedOfferData.offerId);
    }

    // Fetch offer icons from API (icons are too large to store in localStorage)
    async function fetchOfferIcons(offerId) {
      if (!offerId) return;

      try {
        const response = await fetch(getApiUrl(`/api/offers?offerId=${offerId}`));
        const data = await response.json();

        if (data.success && data.offers && data.offers.length > 0) {
          const offer = data.offers[0];
          const selectedCard = document.getElementById("selected-offer");
          updateBadgeIcons(selectedCard, offer);
        }
      } catch (error) {
        console.log("Could not fetch offer icons:", error);
      }
    }

    // Helper function to update badge icons on a card
    function updateBadgeIcons(card, offer) {
      if (!card || !offer) return;

      // Remove existing badge icons
      card.querySelectorAll(".badge-icon").forEach((el) => el.remove());

      // Add badge icons if they exist in the offer data
      const badgePositions = [
        { key: "top_left_icon", className: "badge-top-left" },
        { key: "top_right_icon", className: "badge-top-right" },
        { key: "bottom_left_icon", className: "badge-bottom-left" },
        { key: "bottom_right_icon", className: "badge-bottom-right" },
      ];

      badgePositions.forEach(({ key, className }) => {
        if (offer[key] && offer[key].trim() !== "") {
          const iconValue = offer[key];
          // Skip base64 images (too large)
          if (iconValue.startsWith('data:')) return;
          // Normalize filename: remove spaces, hyphens, underscores, % to match new filenames
          const normalizedIcon = iconValue.replace(/ /g, '').replace(/-/g, '').replace(/_/g, '').replace(/%/g, '').replace(/\s+/g, '');
          const badgeImg = document.createElement("img");
          badgeImg.src = `./corner-icons/${normalizedIcon}`;
          badgeImg.alt = "Badge";
          badgeImg.className = `badge-icon ${className}`;
          badgeImg.style.pointerEvents = "none";
          card.appendChild(badgeImg);
        }
      });
    }

    async function fetchAdditionalOffers() {
      try {
        // Get base values - convert cost to RB if stored as full value
        const rawCost = parseFloat(selectedOfferData.cost);

        // Determine if cost is in RB or full value (if > 1000, it's full value)
        const baseRb = rawCost > 1000 ? Math.round(rawCost / 1000) : rawCost;

        // Get base TIZO from selected offer data
        const baseTizo = Math.round(parseFloat(selectedOfferData.tizoCredit)) || baseRb;

        // Get card type for fetching correct offers
        const cardType = selectedOfferData?.cardType || '';

        console.log("Base RB:", baseRb, "Base TIZO:", baseTizo, "Card Type:", cardType);

        // Calculate upsell RB values: +50 and +100 from base
        const upsell1Rb = baseRb + 50;
        const upsell2Rb = baseRb + 100;

        // Try to fetch actual offers from database for these RB values
        // If found, use the database TIZO. If NOT found, fall back to base + 50/100
        const [offer1, offer2] = await Promise.all([
          fetchOfferByRb(upsell1Rb, cardType),
          fetchOfferByRb(upsell2Rb, cardType)
        ]);

        // First upsell: use DB TIZO if found, otherwise base + 50
        const upsell1Tizo = offer1 ? Math.round(offer1.tizo_credit) : (baseTizo + 50);

        // Second upsell: use DB TIZO if found, otherwise first upsell TIZO + 50 (cascade)
        const upsell2Tizo = offer2 ? Math.round(offer2.tizo_credit) : (upsell1Tizo + 50);

        additionalOffers = [
          { id: 'upsell-1', rb: upsell1Rb, tizo: upsell1Tizo, fromDb: !!offer1 },
          { id: 'upsell-2', rb: upsell2Rb, tizo: upsell2Tizo, fromDb: !!offer2 }
        ];

        console.log("Upsell offers:", additionalOffers.map(o =>
          `${o.rb}RB = ${o.tizo}TIZO ${o.fromDb ? '(from DB)' : '(base + ' + (o.rb - baseRb) + ')'}`
        ).join(', '));

        updateAdditionalOffersDisplay();
        const offersCountEl = document.getElementById("offers-count");
        if (offersCountEl) {
          offersCountEl.textContent = additionalOffers.length;
        }
      } catch (error) {
        console.error("Error fetching upsell offers:", error);
      }
    }

    // Fetch offer from offers table by RB value and card type
    async function fetchOfferByRb(rbValue, cardType) {
      try {
        const cost = rbValue * 1000; // Convert RB to full cost
        let url = getApiUrl(`/api/offers?cost=${cost}`);
        if (cardType) {
          url += `&cardType=${cardType}`;
        }

        const response = await fetch(url);
        const data = await response.json();

        if (data.success && data.offers && data.offers.length > 0) {
          console.log(`Found offer for ${rbValue}RB:`, data.offers[0].tizo_credit, 'TIZO');
          return data.offers[0];
        }
        return null;
      } catch (error) {
        return null;
      }
    }
    async function fetchUpsellTizo(rbValue) {
      try {
        const response = await fetch(getApiUrl(`/api/upsell-offer?rb=${rbValue}`));
        // Silently handle 404 (RB not in database) - fallback will be used
        if (!response.ok) {
          return null;
        }
        const data = await response.json();
        if (data.success) {
          return data.offer;
        }
        return null;
      } catch (error) {
        // Silently fail - fallback calculation will be used
        return null;
      }
    }

    async function updateAdditionalOffersDisplay() {
      const cardColors = ["SMALL-BUTTON-purple.png", "SMALL-BUTTON-ORANGE.png"];

      for (let index = 0; index < additionalOffers.length; index++) {
        const offer = additionalOffers[index];
        // Use rb and tizo directly (already calculated)
        const rbValueEl = document.getElementById(`additional-rb-${index + 1}`);
        const rbUnitEl = document.getElementById(`additional-rb-${index + 1}-unit`);
        if (typeof formatAndUpdateRbDisplay === 'function') {
          formatAndUpdateRbDisplay(rbValueEl, rbUnitEl, offer.rb);
        } else {
          rbValueEl.textContent = offer.rb;
        }
        document.getElementById(`additional-tizo-${index + 1}`).textContent = offer.tizo;
        document.getElementById(`additional-img-${index + 1}`).src = cardColors[index];

        // Update old TIZO strikethrough value (same as RB value - base value before bonus)
        const oldTizoEl = document.getElementById(`additional-old-tizo-${index + 1}`);
        if (oldTizoEl) {
          oldTizoEl.textContent = offer.rb;
        }

        // Store offer data on element
        const cardEl = document.getElementById(`additional-offer-${index + 1}`);
        cardEl.dataset.offerId = offer.id;
        cardEl.dataset.cost = offer.rb * 1000;
        cardEl.dataset.tizoCredit = offer.tizo;

        // Fetch and display icons for this upsell offer by looking up from offers table
        await fetchUpsellOfferIcons(offer.rb, cardEl);
      }

      // Hide extra cards if less than 2 offers
      if (additionalOffers.length < 2) {
        document.getElementById("additional-offer-2").style.display = "none";
      }
      if (additionalOffers.length < 1) {
        document.getElementById("additional-offer-1").style.display = "none";
      }
    }

    // Fetch icons for upsell offer by looking up offer in main offers table by RB value
    async function fetchUpsellOfferIcons(rbValue, cardEl) {
      try {
        // Convert RB to cost (multiply by 1000) and fetch matching offer from offers table
        const cost = rbValue * 1000;
        // Get card type from selected offer for accurate icon lookup
        const cardType = selectedOfferData?.cardType || '';

        // Try to fetch with cardType filter first for exact match
        let response = await fetch(getApiUrl(`/api/offers?cost=${cost}&cardType=${cardType}`));
        let data = await response.json();

        // If no results with cardType, try without it
        if (!data.success || !data.offers || data.offers.length === 0) {
          response = await fetch(getApiUrl(`/api/offers?cost=${cost}`));
          data = await response.json();
        }

        if (data.success && data.offers && data.offers.length > 0) {
          // Use the first matching offer's icons
          const offer = data.offers[0];
          updateBadgeIcons(cardEl, offer);
          console.log(`Applied icons to upsell card ${rbValue}RB:`, {
            top_left: offer.top_left_icon ? 'yes' : 'no',
            top_right: offer.top_right_icon ? 'yes' : 'no',
            bottom_left: offer.bottom_left_icon ? 'yes' : 'no',
            bottom_right: offer.bottom_right_icon ? 'yes' : 'no'
          });
        }
      } catch (error) {
        console.log(`Could not fetch icons for upsell offer ${rbValue}RB:`, error);
      }
    }

    function updateMessageForSelection(selectedCard) {
      const lang = getCurrentLanguage();
      const t = translations[lang];
      const greatChoiceEl = document.querySelector(".great-choice");

      if (!selectedCard) {
        // No selection - show initial message
        greatChoiceEl.innerHTML = t.greatChoice;
        return;
      }

      const cardId = selectedCard.id;

      if (cardId === "selected-offer") {
        // Top card selected - user not interested in upsells
        greatChoiceEl.innerHTML = t.notInterested;
      } else if (cardId === "additional-offer-1") {
        // Middle card selected - smart move
        greatChoiceEl.innerHTML = t.smartMove;
      } else if (cardId === "additional-offer-2") {
        // Bottom card selected - awesome pick (best offer)
        greatChoiceEl.innerHTML = t.topOffer;
      }

      // Hide special offers text when a selection is made
      const specialOffersEl = document.querySelector(".special-offers-text");
      if (specialOffersEl) {
        specialOffersEl.style.display = "none";
      }

      // Blackout "YOUR CHOSEN OPTION" text when an upsell is selected
      const youChoseEl = document.getElementById("you-chose-text");
      if (youChoseEl) {
        if (cardId === "selected-offer") {
          youChoseEl.style.opacity = "1";
        } else {
          youChoseEl.style.opacity = "0.2";
        }
      }
    }

    function selectOfferCard(cardEl) {
      // Play click sound effect
      playClickSound();

      if (window.isEditModeActive && window.isEditModeActive()) return;

      // Single selection - remove selection from all cards first
      document.querySelectorAll(".selected-offer-card, .additional-offer-card").forEach((c) => c.classList.remove("selected"));

      // Select this card
      cardEl.classList.add("selected");

      // Add selection-made class to container for blackout effect
      document.querySelector(".content").classList.add("selection-made");

      // Update message based on selection
      updateMessageForSelection(cardEl);
    }

    function selectAdditionalOffer(cardEl) {
      // Play click sound effect
      playClickSound();

      if (window.isEditModeActive && window.isEditModeActive()) return;

      // Single selection - remove selection from all cards first
      document.querySelectorAll(".selected-offer-card, .additional-offer-card").forEach((c) => c.classList.remove("selected"));

      // Select this card
      cardEl.classList.add("selected");

      // Add selection-made class to container for blackout effect
      document.querySelector(".content").classList.add("selection-made");

      // Update message based on selection
      updateMessageForSelection(cardEl);
    }

    function handleNext() {
      if (window.isEditModeActive && window.isEditModeActive()) return;

      // Check if user selected an upsell offer (one of the "better" offers below)
      const selectedCards = document.querySelectorAll(".additional-offer-card.selected");

      if (selectedCards.length > 0) {
        // User selected an upsell offer - use ONLY that offer (replace, don't add)
        // Take the last selected card as the chosen one
        const chosenCard = selectedCards[selectedCards.length - 1];
        const newOfferCost = parseFloat(chosenCard.dataset.cost) || 0;
        const newOfferTizo = parseFloat(chosenCard.dataset.tizoCredit) || 0;

        // REPLACE the original offer with the new selected offer
        updateSession({
          offerCost: newOfferCost,
          offerTizo: newOfferTizo,
        });

        console.log("Offer REPLACED with upsell:", {
          offerCost: newOfferCost,
          offerTizo: newOfferTizo,
        });
      } else {
        // User didn't select any upsell - keep original offer (already in session)
        console.log("Keeping original offer from session");
      }

      // Save source page for back navigation and navigate to scratch card
      updateSession({ scratchCardSource: "chosen-offer" });
      window.location.href = "scratch-card.html";
    }

    // Initialize on page load
    document.addEventListener("DOMContentLoaded", () => {
      initAudio();
      loadOfferData();
    });

    // Initialize edit mode
    if (typeof initEditMode === 'function') {

    }
  </script>

  <span id="PING_IFRAME_FORM_DETECTION" style="display: none"></span>

  <span id="PING_IFRAME_FORM_DETECTION" style="display: none"></span>

  <span id="PING_IFRAME_FORM_DETECTION" style="display: none"></span><span id="PING_IFRAME_FORM_DETECTION"
    style="display: none"></span>
</body>

</html>